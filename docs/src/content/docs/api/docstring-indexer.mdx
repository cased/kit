---
title: DocstringIndexer API
description: API documentation for the DocstringIndexer class.
---

The `DocstringIndexer` class is responsible for building a vector index of AI-generated code summaries (docstrings). It processes files in a repository, generates summaries for code symbols (or entire files), embeds these summaries, and stores them in a configurable vector database backend. It uses a separate **cache backend** to store metadata (like file hashes) to avoid reprocessing unchanged files. Once an index is built, it can be queried using the [`SummarySearcher`](/api/summary-searcher) class.

## Constructor

**Class: `DocstringIndexer`**
*(defined in `kit/docstring_indexer.py`)*

```python
from kit import Repository, Summarizer
from kit.docstring_indexer import DocstringIndexer, EmbedFn # EmbedFn is Optional[Callable[[str], List[float]]]
from kit.vector_searcher import VectorDBBackend # Optional
from kit.cache_backend import CacheBackend # Optional

# Example basic initialization (uses default file cache and vector backend)
repo = Repository("/path/to/your/repo")
summarizer = Summarizer() # Assumes OPENAI_API_KEY is set or local model configured
indexer = DocstringIndexer(repo=repo, summarizer=summarizer) 

# Example with custom embedding function, explicit file cache, and custom vector backend
# def my_custom_embed_fn(text: str) -> List[float]:
#     # ... your embedding logic ...
#     return [0.1, 0.2, ...]
#
# from kit.vector_searcher import ChromaDBBackend
# from kit.cache_backends.filesystem import FilesystemCacheBackend
#
# custom_vector_backend = ChromaDBBackend(collection_name="my_custom_index", persist_dir="./my_chroma_db")
# custom_cache_backend = FilesystemCacheBackend(persist_dir="./my_kit_cache")
#
# indexer_custom = DocstringIndexer(
#     repo=repo,
#     summarizer=summarizer,
#     embed_fn=my_custom_embed_fn,
#     backend=custom_vector_backend,
#     cache_backend=custom_cache_backend,
#     persist_dir="./my_shared_persist_dir" # Can be used if backends don't configure their own
# )

# Example using Redis cache backend (requires redis library: pip install redis)
# import redis
# from kit.cache_backends.redis import RedisCacheBackend
#
# redis_client = redis.Redis.from_url("redis://localhost:6379/0")
# redis_cache = RedisCacheBackend(redis_client=redis_client, cache_key="my_project_doc_cache")
#
# indexer_redis = DocstringIndexer(
#     repo=repo,
#     summarizer=summarizer,
#     cache_backend=redis_cache 
#     # Uses default vector backend (ChromaDB) and default embedding
# )
```

**Parameters:**

*   **`repo`** (`Repository`, required):
    An instance of `kit.Repository` pointing to the codebase to be indexed.
*   **`summarizer`** (`Summarizer`, required):
    An instance of `kit.Summarizer` used to generate summaries for code symbols or files.
*   **`embed_fn`** (`Optional[Callable[[str], List[float]]]`, default: `SentenceTransformer('all-MiniLM-L6-v2')`):
    A function that takes a string and returns its embedding (a list of floats).
    If `None`, a default embedding function using `sentence-transformers` (`all-MiniLM-L6-v2` model) will be used.
    The `sentence-transformers` package must be installed for the default to work (`pip install sentence-transformers`).
*   **`backend`** (`Optional[VectorDBBackend]`, default: `ChromaDBBackend`):
    The vector database backend to use for storing and querying embeddings.
    If `None`, a `ChromaDBBackend` instance will be created using the `persist_dir`.
    The default collection name is `kit_docstring_index`.
*   **`persist_dir`** (`Optional[str]`, default: `repo.repo_path / ".kit_cache" / "docstring_db"` or `cwd / ".kit_cache" / "docstring_db_generic"`):
    The *default* directory for persistent storage *if specific backends don't configure their own paths*. 
    - If the default `ChromaDBBackend` is used for vectors, it will store its data here unless configured otherwise.
    - If the default `FilesystemCacheBackend` is used for caching, it will store its `meta.json` here unless configured otherwise.
    If `None`, a default path is constructed within a `.kit_cache` directory, usually inside the repository path.
*   **`cache_backend`** (`Optional[CacheBackend]`, default: `FilesystemCacheBackend`):
    The backend used to store cache metadata (e.g., file hashes to track changes).
    - If `None`, a `FilesystemCacheBackend` instance is created, storing `meta.json` in the `persist_dir`.
    - Allows using alternative backends like `RedisCacheBackend` for shared caching. See `kit.cache_backends`.

## Methods

### `build`

**Method: `DocstringIndexer.build`**
*(defined in `kit/docstring_indexer.py`)*

Builds or rebuilds the docstring index. It iterates through files in the repository (respecting `.gitignore` and `file_extensions`), extracts symbols or uses whole file content based on the `level`, generates summaries, embeds them, and adds them to the vector database. It also handles caching to avoid re-processing unchanged symbols/files.

```python
# Build the index (symbol-level by default for .py files)
indexer.build()

# Force a rebuild, ignoring any existing cache
indexer.build(force=True)

# Index at file level instead of symbol level
indexer.build(level="file")

# Index only specific file extensions
indexer.build(file_extensions=[".py", ".mdx"])
```

**Parameters:**

*   **`force`** (`bool`, default: `False`):
    If `True`, the entire index is rebuilt, ignoring any existing cache and potentially overwriting existing data in the backend.
    If `False`, uses cached summaries/embeddings for unchanged code and only processes new/modified code. It also avoids re-initializing the backend if it already contains data, unless changes are detected.
*   **`level`** (`str`, default: `'symbol'`):
    The granularity of indexing.
    - `'symbol'`: Extracts and summarizes individual symbols (functions, classes, methods) from files.
    - `'file'`: Summarizes the entire content of each file.
*   **`file_extensions`** (`Optional[List[str]]`, default: `None` (uses Repository's default, typically .py)):
    A list of file extensions (e.g., `['.py', '.md']`) to include in the indexing process.
    If `None`, uses the default behavior of the `Repository` instance, which typically focuses on Python files but can be configured.

**Returns:** `None`

### `get_searcher`

**Method: `DocstringIndexer.get_searcher`**
*(defined in `kit/docstring_indexer.py`)*

Returns a `SummarySearcher` instance that is configured to query the index managed by this `DocstringIndexer`.

This provides a convenient way to obtain a search interface after the indexer has been built or loaded, without needing to manually instantiate `SummarySearcher`.

```python
# Assuming 'indexer' is an initialized DocstringIndexer instance
# indexer.build() # or it has been loaded with a pre-built index

search_interface = indexer.get_searcher()
results = search_interface.search("my search query", top_k=3)

for result in results:
    print(result)
```

**Parameters:** None

**Returns:** `SummarySearcher`

    An instance of `SummarySearcher` linked to this indexer.

